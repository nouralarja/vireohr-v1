{"dependencies":[{"name":"../threads","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":48,"index":48}}],"key":"Fh+chV+u1CN8c14Zj6fzkh4FXGs="}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.prepareUIRegistry = void 0;\n  var _threads = _$$_REQUIRE(_dependencyMap[0], \"../threads\");\n  var prepareUIRegistry = exports.prepareUIRegistry = (0, _threads.runOnUIImmediately)(function () {\n    'worklet';\n\n    var frameCallbackRegistry = {\n      frameCallbackRegistry: new Map(),\n      activeFrameCallbacks: new Set(),\n      previousFrameTimestamp: null,\n      nextCallId: 0,\n      runCallbacks: function runCallbacks(callId) {\n        var _this = this;\n        var _loop = function loop(timestamp) {\n          if (callId !== _this.nextCallId) {\n            return;\n          }\n          if (_this.previousFrameTimestamp === null) {\n            _this.previousFrameTimestamp = timestamp;\n          }\n          var delta = timestamp - _this.previousFrameTimestamp;\n          _this.activeFrameCallbacks.forEach(function (callbackId) {\n            var callbackDetails = _this.frameCallbackRegistry.get(callbackId);\n            var startTime = callbackDetails.startTime;\n            if (startTime === null) {\n              // First frame\n              callbackDetails.startTime = timestamp;\n              callbackDetails.callback({\n                timestamp: timestamp,\n                timeSincePreviousFrame: null,\n                timeSinceFirstFrame: 0\n              });\n            } else {\n              // Next frame\n              callbackDetails.callback({\n                timestamp: timestamp,\n                timeSincePreviousFrame: delta,\n                timeSinceFirstFrame: timestamp - startTime\n              });\n            }\n          });\n          if (_this.activeFrameCallbacks.size > 0) {\n            _this.previousFrameTimestamp = timestamp;\n            requestAnimationFrame(_loop);\n          } else {\n            _this.previousFrameTimestamp = null;\n          }\n        };\n\n        // runCallback() should only be called after registering a callback,\n        // so if there is only one active callback, then it means that there were\n        // zero previously and the loop isn't running yet.\n        if (this.activeFrameCallbacks.size === 1 && callId === this.nextCallId) {\n          requestAnimationFrame(_loop);\n        }\n      },\n      registerFrameCallback: function registerFrameCallback(callback, callbackId) {\n        this.frameCallbackRegistry.set(callbackId, {\n          callback: callback,\n          startTime: null\n        });\n      },\n      unregisterFrameCallback: function unregisterFrameCallback(callbackId) {\n        this.manageStateFrameCallback(callbackId, false);\n        this.frameCallbackRegistry.delete(callbackId);\n      },\n      manageStateFrameCallback: function manageStateFrameCallback(callbackId, state) {\n        if (callbackId === -1) {\n          return;\n        }\n        if (state) {\n          this.activeFrameCallbacks.add(callbackId);\n          this.runCallbacks(this.nextCallId);\n        } else {\n          var callback = this.frameCallbackRegistry.get(callbackId);\n          callback.startTime = null;\n          this.activeFrameCallbacks.delete(callbackId);\n          if (this.activeFrameCallbacks.size === 0) {\n            this.nextCallId += 1;\n          }\n        }\n      }\n    };\n    global._frameCallbackRegistry = frameCallbackRegistry;\n  });\n});","lineCount":89,"map":[[6,2,1,0],[6,6,1,0,"_threads"],[6,14,1,0],[6,17,1,0,"_$$_REQUIRE"],[6,28,1,0],[6,29,1,0,"_dependencyMap"],[6,43,1,0],[7,2,2,7],[7,6,2,13,"prepareUIRegistry"],[7,23,2,30],[7,26,2,30,"exports"],[7,33,2,30],[7,34,2,30,"prepareUIRegistry"],[7,51,2,30],[7,54,2,33],[7,58,2,33,"runOnUIImmediately"],[7,85,2,51],[7,87,2,52],[7,99,2,58],[8,4,3,2],[8,13,3,11],[10,4,5,2],[10,8,5,8,"frameCallbackRegistry"],[10,29,5,29],[10,32,5,32],[11,6,6,4,"frameCallbackRegistry"],[11,27,6,25],[11,29,6,27],[11,33,6,31,"Map"],[11,36,6,34],[11,37,6,35],[11,38,6,36],[12,6,7,4,"activeFrameCallbacks"],[12,26,7,24],[12,28,7,26],[12,32,7,30,"Set"],[12,35,7,33],[12,36,7,34],[12,37,7,35],[13,6,8,4,"previousFrameTimestamp"],[13,28,8,26],[13,30,8,28],[13,34,8,32],[14,6,9,4,"nextCallId"],[14,16,9,14],[14,18,9,16],[14,19,9,17],[15,6,10,4,"runCallbacks"],[15,18,10,16],[15,29,10,4,"runCallbacks"],[15,41,10,16,"runCallbacks"],[15,42,10,17,"callId"],[15,48,10,23],[15,50,10,25],[16,8,10,25],[16,12,10,25,"_this"],[16,17,10,25],[17,8,11,6],[17,12,11,12,"loop"],[17,17,11,16],[17,20,11,19],[17,29,11,12,"loop"],[17,33,11,16,"loop"],[17,34,11,19,"timestamp"],[17,43,11,28],[17,45,11,32],[18,10,12,8],[18,14,12,12,"callId"],[18,20,12,18],[18,25,12,23,"_this"],[18,30,12,27],[18,31,12,28,"nextCallId"],[18,41,12,38],[18,43,12,40],[19,12,13,10],[20,10,14,8],[21,10,15,8],[21,14,15,12,"_this"],[21,19,15,16],[21,20,15,17,"previousFrameTimestamp"],[21,42,15,39],[21,47,15,44],[21,51,15,48],[21,53,15,50],[22,12,16,10,"_this"],[22,17,16,14],[22,18,16,15,"previousFrameTimestamp"],[22,40,16,37],[22,43,16,40,"timestamp"],[22,52,16,49],[23,10,17,8],[24,10,18,8],[24,14,18,14,"delta"],[24,19,18,19],[24,22,18,22,"timestamp"],[24,31,18,31],[24,34,18,34,"_this"],[24,39,18,38],[24,40,18,39,"previousFrameTimestamp"],[24,62,18,61],[25,10,19,8,"_this"],[25,15,19,12],[25,16,19,13,"activeFrameCallbacks"],[25,36,19,33],[25,37,19,34,"forEach"],[25,44,19,41],[25,45,19,42],[25,55,19,42,"callbackId"],[25,65,19,52],[25,67,19,56],[26,12,20,10],[26,16,20,16,"callbackDetails"],[26,31,20,31],[26,34,20,34,"_this"],[26,39,20,38],[26,40,20,39,"frameCallbackRegistry"],[26,61,20,60],[26,62,20,61,"get"],[26,65,20,64],[26,66,20,65,"callbackId"],[26,76,20,75],[26,77,20,76],[27,12,21,10],[27,16,22,12,"startTime"],[27,25,22,21],[27,28,23,14,"callbackDetails"],[27,43,23,29],[27,44,22,12,"startTime"],[27,53,22,21],[28,12,24,10],[28,16,24,14,"startTime"],[28,25,24,23],[28,30,24,28],[28,34,24,32],[28,36,24,34],[29,14,25,12],[30,14,26,12,"callbackDetails"],[30,29,26,27],[30,30,26,28,"startTime"],[30,39,26,37],[30,42,26,40,"timestamp"],[30,51,26,49],[31,14,27,12,"callbackDetails"],[31,29,27,27],[31,30,27,28,"callback"],[31,38,27,36],[31,39,27,37],[32,16,28,14,"timestamp"],[32,25,28,23],[32,27,28,14,"timestamp"],[32,36,28,23],[33,16,29,14,"timeSincePreviousFrame"],[33,38,29,36],[33,40,29,38],[33,44,29,42],[34,16,30,14,"timeSinceFirstFrame"],[34,35,30,33],[34,37,30,35],[35,14,31,12],[35,15,31,13],[35,16,31,14],[36,12,32,10],[36,13,32,11],[36,19,32,17],[37,14,33,12],[38,14,34,12,"callbackDetails"],[38,29,34,27],[38,30,34,28,"callback"],[38,38,34,36],[38,39,34,37],[39,16,35,14,"timestamp"],[39,25,35,23],[39,27,35,14,"timestamp"],[39,36,35,23],[40,16,36,14,"timeSincePreviousFrame"],[40,38,36,36],[40,40,36,38,"delta"],[40,45,36,43],[41,16,37,14,"timeSinceFirstFrame"],[41,35,37,33],[41,37,37,35,"timestamp"],[41,46,37,44],[41,49,37,47,"startTime"],[42,14,38,12],[42,15,38,13],[42,16,38,14],[43,12,39,10],[44,10,40,8],[44,11,40,9],[44,12,40,10],[45,10,41,8],[45,14,41,12,"_this"],[45,19,41,16],[45,20,41,17,"activeFrameCallbacks"],[45,40,41,37],[45,41,41,38,"size"],[45,45,41,42],[45,48,41,45],[45,49,41,46],[45,51,41,48],[46,12,42,10,"_this"],[46,17,42,14],[46,18,42,15,"previousFrameTimestamp"],[46,40,42,37],[46,43,42,40,"timestamp"],[46,52,42,49],[47,12,43,10,"requestAnimationFrame"],[47,33,43,31],[47,34,43,32,"loop"],[47,39,43,36],[47,40,43,37],[48,10,44,8],[48,11,44,9],[48,17,44,15],[49,12,45,10,"_this"],[49,17,45,14],[49,18,45,15,"previousFrameTimestamp"],[49,40,45,37],[49,43,45,40],[49,47,45,44],[50,10,46,8],[51,8,47,6],[51,9,47,7],[53,8,49,6],[54,8,50,6],[55,8,51,6],[56,8,52,6],[56,12,52,10],[56,16,52,14],[56,17,52,15,"activeFrameCallbacks"],[56,37,52,35],[56,38,52,36,"size"],[56,42,52,40],[56,47,52,45],[56,48,52,46],[56,52,52,50,"callId"],[56,58,52,56],[56,63,52,61],[56,67,52,65],[56,68,52,66,"nextCallId"],[56,78,52,76],[56,80,52,78],[57,10,53,8,"requestAnimationFrame"],[57,31,53,29],[57,32,53,30,"loop"],[57,37,53,34],[57,38,53,35],[58,8,54,6],[59,6,55,4],[59,7,55,5],[60,6,56,4,"registerFrameCallback"],[60,27,56,25],[60,38,56,4,"registerFrameCallback"],[60,59,56,25,"registerFrameCallback"],[60,60,56,26,"callback"],[60,68,56,34],[60,70,56,36,"callbackId"],[60,80,56,46],[60,82,56,48],[61,8,57,6],[61,12,57,10],[61,13,57,11,"frameCallbackRegistry"],[61,34,57,32],[61,35,57,33,"set"],[61,38,57,36],[61,39,57,37,"callbackId"],[61,49,57,47],[61,51,57,49],[62,10,58,8,"callback"],[62,18,58,16],[62,20,58,18,"callback"],[62,28,58,26],[63,10,59,8,"startTime"],[63,19,59,17],[63,21,59,19],[64,8,60,6],[64,9,60,7],[64,10,60,8],[65,6,61,4],[65,7,61,5],[66,6,62,4,"unregisterFrameCallback"],[66,29,62,27],[66,40,62,4,"unregisterFrameCallback"],[66,63,62,27,"unregisterFrameCallback"],[66,64,62,28,"callbackId"],[66,74,62,38],[66,76,62,40],[67,8,63,6],[67,12,63,10],[67,13,63,11,"manageStateFrameCallback"],[67,37,63,35],[67,38,63,36,"callbackId"],[67,48,63,46],[67,50,63,48],[67,55,63,53],[67,56,63,54],[68,8,64,6],[68,12,64,10],[68,13,64,11,"frameCallbackRegistry"],[68,34,64,32],[68,35,64,33,"delete"],[68,41,64,39],[68,42,64,40,"callbackId"],[68,52,64,50],[68,53,64,51],[69,6,65,4],[69,7,65,5],[70,6,66,4,"manageStateFrameCallback"],[70,30,66,28],[70,41,66,4,"manageStateFrameCallback"],[70,65,66,28,"manageStateFrameCallback"],[70,66,66,29,"callbackId"],[70,76,66,39],[70,78,66,41,"state"],[70,83,66,46],[70,85,66,48],[71,8,67,6],[71,12,67,10,"callbackId"],[71,22,67,20],[71,27,67,25],[71,28,67,26],[71,29,67,27],[71,31,67,29],[72,10,68,8],[73,8,69,6],[74,8,70,6],[74,12,70,10,"state"],[74,17,70,15],[74,19,70,17],[75,10,71,8],[75,14,71,12],[75,15,71,13,"activeFrameCallbacks"],[75,35,71,33],[75,36,71,34,"add"],[75,39,71,37],[75,40,71,38,"callbackId"],[75,50,71,48],[75,51,71,49],[76,10,72,8],[76,14,72,12],[76,15,72,13,"runCallbacks"],[76,27,72,25],[76,28,72,26],[76,32,72,30],[76,33,72,31,"nextCallId"],[76,43,72,41],[76,44,72,42],[77,8,73,6],[77,9,73,7],[77,15,73,13],[78,10,74,8],[78,14,74,14,"callback"],[78,22,74,22],[78,25,74,25],[78,29,74,29],[78,30,74,30,"frameCallbackRegistry"],[78,51,74,51],[78,52,74,52,"get"],[78,55,74,55],[78,56,74,56,"callbackId"],[78,66,74,66],[78,67,74,67],[79,10,75,8,"callback"],[79,18,75,16],[79,19,75,17,"startTime"],[79,28,75,26],[79,31,75,29],[79,35,75,33],[80,10,76,8],[80,14,76,12],[80,15,76,13,"activeFrameCallbacks"],[80,35,76,33],[80,36,76,34,"delete"],[80,42,76,40],[80,43,76,41,"callbackId"],[80,53,76,51],[80,54,76,52],[81,10,77,8],[81,14,77,12],[81,18,77,16],[81,19,77,17,"activeFrameCallbacks"],[81,39,77,37],[81,40,77,38,"size"],[81,44,77,42],[81,49,77,47],[81,50,77,48],[81,52,77,50],[82,12,78,10],[82,16,78,14],[82,17,78,15,"nextCallId"],[82,27,78,25],[82,31,78,29],[82,32,78,30],[83,10,79,8],[84,8,80,6],[85,6,81,4],[86,4,82,2],[86,5,82,3],[87,4,83,2,"global"],[87,10,83,8],[87,11,83,9,"_frameCallbackRegistry"],[87,33,83,31],[87,36,83,34,"frameCallbackRegistry"],[87,57,83,55],[88,2,84,0],[88,3,84,1],[88,4,84,2],[89,0,84,3]],"functionMap":{"names":["<global>","runOnUIImmediately$argument_0","frameCallbackRegistry.runCallbacks","loop","activeFrameCallbacks.forEach$argument_0","frameCallbackRegistry.registerFrameCallback","frameCallbackRegistry.unregisterFrameCallback","frameCallbackRegistry.manageStateFrameCallback"],"mappings":"AAA;oDCC;ICQ;mBCC;0CCQ;SDqB;ODO;KDQ;IIC;KJK;IKC;KLG;IMC;KNe;CDG"}},"type":"js/module"}]}