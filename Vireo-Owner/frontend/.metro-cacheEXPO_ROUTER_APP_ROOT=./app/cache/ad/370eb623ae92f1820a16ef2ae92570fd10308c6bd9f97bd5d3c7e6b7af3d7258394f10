{"dependencies":[{"name":"../threads.js","data":{"asyncType":null,"locs":[{"start":{"line":3,"column":0,"index":15},"end":{"line":3,"column":51,"index":66}}],"key":"y2AfgK5jQVhKgd/zAlGmmQksgS0="}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.prepareUIRegistry = void 0;\n  var _threads = _$$_REQUIRE(_dependencyMap[0], \"../threads.js\");\n  var prepareUIRegistry = exports.prepareUIRegistry = (0, _threads.runOnUIImmediately)(function () {\n    'worklet';\n\n    var frameCallbackRegistry = {\n      frameCallbackRegistry: new Map(),\n      activeFrameCallbacks: new Set(),\n      previousFrameTimestamp: null,\n      nextCallId: 0,\n      runCallbacks: function runCallbacks(callId) {\n        var _this = this;\n        var _loop = function loop(timestamp) {\n          if (callId !== _this.nextCallId) {\n            return;\n          }\n          if (_this.previousFrameTimestamp === null) {\n            _this.previousFrameTimestamp = timestamp;\n          }\n          var delta = timestamp - _this.previousFrameTimestamp;\n          _this.activeFrameCallbacks.forEach(function (callbackId) {\n            var callbackDetails = _this.frameCallbackRegistry.get(callbackId);\n            var startTime = callbackDetails.startTime;\n            if (startTime === null) {\n              // First frame\n              callbackDetails.startTime = timestamp;\n              callbackDetails.callback({\n                timestamp: timestamp,\n                timeSincePreviousFrame: null,\n                timeSinceFirstFrame: 0\n              });\n            } else {\n              // Next frame\n              callbackDetails.callback({\n                timestamp: timestamp,\n                timeSincePreviousFrame: delta,\n                timeSinceFirstFrame: timestamp - startTime\n              });\n            }\n          });\n          if (_this.activeFrameCallbacks.size > 0) {\n            _this.previousFrameTimestamp = timestamp;\n            requestAnimationFrame(_loop);\n          } else {\n            _this.previousFrameTimestamp = null;\n          }\n        };\n\n        // runCallback() should only be called after registering a callback,\n        // so if there is only one active callback, then it means that there were\n        // zero previously and the loop isn't running yet.\n        if (this.activeFrameCallbacks.size === 1 && callId === this.nextCallId) {\n          requestAnimationFrame(_loop);\n        }\n      },\n      registerFrameCallback: function registerFrameCallback(callback, callbackId) {\n        this.frameCallbackRegistry.set(callbackId, {\n          callback: callback,\n          startTime: null\n        });\n      },\n      unregisterFrameCallback: function unregisterFrameCallback(callbackId) {\n        this.manageStateFrameCallback(callbackId, false);\n        this.frameCallbackRegistry.delete(callbackId);\n      },\n      manageStateFrameCallback: function manageStateFrameCallback(callbackId, state) {\n        if (callbackId === -1) {\n          return;\n        }\n        if (state) {\n          this.activeFrameCallbacks.add(callbackId);\n          this.runCallbacks(this.nextCallId);\n        } else {\n          var callback = this.frameCallbackRegistry.get(callbackId);\n          callback.startTime = null;\n          this.activeFrameCallbacks.delete(callbackId);\n          if (this.activeFrameCallbacks.size === 0) {\n            this.nextCallId += 1;\n          }\n        }\n      }\n    };\n    global._frameCallbackRegistry = frameCallbackRegistry;\n  });\n});","lineCount":91,"map":[[2,2,1,0],[2,14,1,12],[4,2,1,13,"Object"],[4,8,1,13],[4,9,1,13,"defineProperty"],[4,23,1,13],[4,24,1,13,"exports"],[4,31,1,13],[5,4,1,13,"value"],[5,9,1,13],[6,2,1,13],[7,2,1,13,"exports"],[7,9,1,13],[7,10,1,13,"prepareUIRegistry"],[7,27,1,13],[8,2,3,0],[8,6,3,0,"_threads"],[8,14,3,0],[8,17,3,0,"_$$_REQUIRE"],[8,28,3,0],[8,29,3,0,"_dependencyMap"],[8,43,3,0],[9,2,4,7],[9,6,4,13,"prepareUIRegistry"],[9,23,4,30],[9,26,4,30,"exports"],[9,33,4,30],[9,34,4,30,"prepareUIRegistry"],[9,51,4,30],[9,54,4,33],[9,58,4,33,"runOnUIImmediately"],[9,85,4,51],[9,87,4,52],[9,99,4,58],[10,4,5,2],[10,13,5,11],[12,4,7,2],[12,8,7,8,"frameCallbackRegistry"],[12,29,7,29],[12,32,7,32],[13,6,8,4,"frameCallbackRegistry"],[13,27,8,25],[13,29,8,27],[13,33,8,31,"Map"],[13,36,8,34],[13,37,8,35],[13,38,8,36],[14,6,9,4,"activeFrameCallbacks"],[14,26,9,24],[14,28,9,26],[14,32,9,30,"Set"],[14,35,9,33],[14,36,9,34],[14,37,9,35],[15,6,10,4,"previousFrameTimestamp"],[15,28,10,26],[15,30,10,28],[15,34,10,32],[16,6,11,4,"nextCallId"],[16,16,11,14],[16,18,11,16],[16,19,11,17],[17,6,12,4,"runCallbacks"],[17,18,12,16],[17,29,12,4,"runCallbacks"],[17,41,12,16,"runCallbacks"],[17,42,12,17,"callId"],[17,48,12,23],[17,50,12,25],[18,8,12,25],[18,12,12,25,"_this"],[18,17,12,25],[19,8,13,6],[19,12,13,12,"loop"],[19,17,13,16],[19,20,13,19],[19,29,13,12,"loop"],[19,33,13,16,"loop"],[19,34,13,19,"timestamp"],[19,43,13,28],[19,45,13,32],[20,10,14,8],[20,14,14,12,"callId"],[20,20,14,18],[20,25,14,23,"_this"],[20,30,14,27],[20,31,14,28,"nextCallId"],[20,41,14,38],[20,43,14,40],[21,12,15,10],[22,10,16,8],[23,10,17,8],[23,14,17,12,"_this"],[23,19,17,16],[23,20,17,17,"previousFrameTimestamp"],[23,42,17,39],[23,47,17,44],[23,51,17,48],[23,53,17,50],[24,12,18,10,"_this"],[24,17,18,14],[24,18,18,15,"previousFrameTimestamp"],[24,40,18,37],[24,43,18,40,"timestamp"],[24,52,18,49],[25,10,19,8],[26,10,20,8],[26,14,20,14,"delta"],[26,19,20,19],[26,22,20,22,"timestamp"],[26,31,20,31],[26,34,20,34,"_this"],[26,39,20,38],[26,40,20,39,"previousFrameTimestamp"],[26,62,20,61],[27,10,21,8,"_this"],[27,15,21,12],[27,16,21,13,"activeFrameCallbacks"],[27,36,21,33],[27,37,21,34,"forEach"],[27,44,21,41],[27,45,21,42],[27,55,21,42,"callbackId"],[27,65,21,52],[27,67,21,56],[28,12,22,10],[28,16,22,16,"callbackDetails"],[28,31,22,31],[28,34,22,34,"_this"],[28,39,22,38],[28,40,22,39,"frameCallbackRegistry"],[28,61,22,60],[28,62,22,61,"get"],[28,65,22,64],[28,66,22,65,"callbackId"],[28,76,22,75],[28,77,22,76],[29,12,23,10],[29,16,24,12,"startTime"],[29,25,24,21],[29,28,25,14,"callbackDetails"],[29,43,25,29],[29,44,24,12,"startTime"],[29,53,24,21],[30,12,26,10],[30,16,26,14,"startTime"],[30,25,26,23],[30,30,26,28],[30,34,26,32],[30,36,26,34],[31,14,27,12],[32,14,28,12,"callbackDetails"],[32,29,28,27],[32,30,28,28,"startTime"],[32,39,28,37],[32,42,28,40,"timestamp"],[32,51,28,49],[33,14,29,12,"callbackDetails"],[33,29,29,27],[33,30,29,28,"callback"],[33,38,29,36],[33,39,29,37],[34,16,30,14,"timestamp"],[34,25,30,23],[34,27,30,14,"timestamp"],[34,36,30,23],[35,16,31,14,"timeSincePreviousFrame"],[35,38,31,36],[35,40,31,38],[35,44,31,42],[36,16,32,14,"timeSinceFirstFrame"],[36,35,32,33],[36,37,32,35],[37,14,33,12],[37,15,33,13],[37,16,33,14],[38,12,34,10],[38,13,34,11],[38,19,34,17],[39,14,35,12],[40,14,36,12,"callbackDetails"],[40,29,36,27],[40,30,36,28,"callback"],[40,38,36,36],[40,39,36,37],[41,16,37,14,"timestamp"],[41,25,37,23],[41,27,37,14,"timestamp"],[41,36,37,23],[42,16,38,14,"timeSincePreviousFrame"],[42,38,38,36],[42,40,38,38,"delta"],[42,45,38,43],[43,16,39,14,"timeSinceFirstFrame"],[43,35,39,33],[43,37,39,35,"timestamp"],[43,46,39,44],[43,49,39,47,"startTime"],[44,14,40,12],[44,15,40,13],[44,16,40,14],[45,12,41,10],[46,10,42,8],[46,11,42,9],[46,12,42,10],[47,10,43,8],[47,14,43,12,"_this"],[47,19,43,16],[47,20,43,17,"activeFrameCallbacks"],[47,40,43,37],[47,41,43,38,"size"],[47,45,43,42],[47,48,43,45],[47,49,43,46],[47,51,43,48],[48,12,44,10,"_this"],[48,17,44,14],[48,18,44,15,"previousFrameTimestamp"],[48,40,44,37],[48,43,44,40,"timestamp"],[48,52,44,49],[49,12,45,10,"requestAnimationFrame"],[49,33,45,31],[49,34,45,32,"loop"],[49,39,45,36],[49,40,45,37],[50,10,46,8],[50,11,46,9],[50,17,46,15],[51,12,47,10,"_this"],[51,17,47,14],[51,18,47,15,"previousFrameTimestamp"],[51,40,47,37],[51,43,47,40],[51,47,47,44],[52,10,48,8],[53,8,49,6],[53,9,49,7],[55,8,51,6],[56,8,52,6],[57,8,53,6],[58,8,54,6],[58,12,54,10],[58,16,54,14],[58,17,54,15,"activeFrameCallbacks"],[58,37,54,35],[58,38,54,36,"size"],[58,42,54,40],[58,47,54,45],[58,48,54,46],[58,52,54,50,"callId"],[58,58,54,56],[58,63,54,61],[58,67,54,65],[58,68,54,66,"nextCallId"],[58,78,54,76],[58,80,54,78],[59,10,55,8,"requestAnimationFrame"],[59,31,55,29],[59,32,55,30,"loop"],[59,37,55,34],[59,38,55,35],[60,8,56,6],[61,6,57,4],[61,7,57,5],[62,6,58,4,"registerFrameCallback"],[62,27,58,25],[62,38,58,4,"registerFrameCallback"],[62,59,58,25,"registerFrameCallback"],[62,60,58,26,"callback"],[62,68,58,34],[62,70,58,36,"callbackId"],[62,80,58,46],[62,82,58,48],[63,8,59,6],[63,12,59,10],[63,13,59,11,"frameCallbackRegistry"],[63,34,59,32],[63,35,59,33,"set"],[63,38,59,36],[63,39,59,37,"callbackId"],[63,49,59,47],[63,51,59,49],[64,10,60,8,"callback"],[64,18,60,16],[64,20,60,8,"callback"],[64,28,60,16],[65,10,61,8,"startTime"],[65,19,61,17],[65,21,61,19],[66,8,62,6],[66,9,62,7],[66,10,62,8],[67,6,63,4],[67,7,63,5],[68,6,64,4,"unregisterFrameCallback"],[68,29,64,27],[68,40,64,4,"unregisterFrameCallback"],[68,63,64,27,"unregisterFrameCallback"],[68,64,64,28,"callbackId"],[68,74,64,38],[68,76,64,40],[69,8,65,6],[69,12,65,10],[69,13,65,11,"manageStateFrameCallback"],[69,37,65,35],[69,38,65,36,"callbackId"],[69,48,65,46],[69,50,65,48],[69,55,65,53],[69,56,65,54],[70,8,66,6],[70,12,66,10],[70,13,66,11,"frameCallbackRegistry"],[70,34,66,32],[70,35,66,33,"delete"],[70,41,66,39],[70,42,66,40,"callbackId"],[70,52,66,50],[70,53,66,51],[71,6,67,4],[71,7,67,5],[72,6,68,4,"manageStateFrameCallback"],[72,30,68,28],[72,41,68,4,"manageStateFrameCallback"],[72,65,68,28,"manageStateFrameCallback"],[72,66,68,29,"callbackId"],[72,76,68,39],[72,78,68,41,"state"],[72,83,68,46],[72,85,68,48],[73,8,69,6],[73,12,69,10,"callbackId"],[73,22,69,20],[73,27,69,25],[73,28,69,26],[73,29,69,27],[73,31,69,29],[74,10,70,8],[75,8,71,6],[76,8,72,6],[76,12,72,10,"state"],[76,17,72,15],[76,19,72,17],[77,10,73,8],[77,14,73,12],[77,15,73,13,"activeFrameCallbacks"],[77,35,73,33],[77,36,73,34,"add"],[77,39,73,37],[77,40,73,38,"callbackId"],[77,50,73,48],[77,51,73,49],[78,10,74,8],[78,14,74,12],[78,15,74,13,"runCallbacks"],[78,27,74,25],[78,28,74,26],[78,32,74,30],[78,33,74,31,"nextCallId"],[78,43,74,41],[78,44,74,42],[79,8,75,6],[79,9,75,7],[79,15,75,13],[80,10,76,8],[80,14,76,14,"callback"],[80,22,76,22],[80,25,76,25],[80,29,76,29],[80,30,76,30,"frameCallbackRegistry"],[80,51,76,51],[80,52,76,52,"get"],[80,55,76,55],[80,56,76,56,"callbackId"],[80,66,76,66],[80,67,76,67],[81,10,77,8,"callback"],[81,18,77,16],[81,19,77,17,"startTime"],[81,28,77,26],[81,31,77,29],[81,35,77,33],[82,10,78,8],[82,14,78,12],[82,15,78,13,"activeFrameCallbacks"],[82,35,78,33],[82,36,78,34,"delete"],[82,42,78,40],[82,43,78,41,"callbackId"],[82,53,78,51],[82,54,78,52],[83,10,79,8],[83,14,79,12],[83,18,79,16],[83,19,79,17,"activeFrameCallbacks"],[83,39,79,37],[83,40,79,38,"size"],[83,44,79,42],[83,49,79,47],[83,50,79,48],[83,52,79,50],[84,12,80,10],[84,16,80,14],[84,17,80,15,"nextCallId"],[84,27,80,25],[84,31,80,29],[84,32,80,30],[85,10,81,8],[86,8,82,6],[87,6,83,4],[88,4,84,2],[88,5,84,3],[89,4,85,2,"global"],[89,10,85,8],[89,11,85,9,"_frameCallbackRegistry"],[89,33,85,31],[89,36,85,34,"frameCallbackRegistry"],[89,57,85,55],[90,2,86,0],[90,3,86,1],[90,4,86,2],[91,0,86,3]],"functionMap":{"names":["<global>","runOnUIImmediately$argument_0","frameCallbackRegistry.runCallbacks","loop","activeFrameCallbacks.forEach$argument_0","frameCallbackRegistry.registerFrameCallback","frameCallbackRegistry.unregisterFrameCallback","frameCallbackRegistry.manageStateFrameCallback"],"mappings":"AAA;oDCG;ICQ;mBCC;0CCQ;SDqB;ODO;KDQ;IIC;KJK;IKC;KLG;IMC;KNe;CDG"}},"type":"js/module"}]}